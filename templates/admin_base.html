<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>{% block title %}Admin Dashboard{% endblock %} - Cully Report Generator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/form.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    {% block extra_css %}{% endblock %}
</head>
<body class="dashboard-layout">
    <div class="admin-container">
        <!-- Header -->
        <div class="admin-header">
            <div class="header-content">
                <div class="header-info">
                    <h1><i class="fa fa-{% block page_icon %}tachometer-alt{% endblock %}"></i> {% block page_title %}Dashboard{% endblock %}</h1>
                    <p>{% block page_subtitle %}System administration, user management, and platform oversight{% endblock %}</p>
                </div>
                <img src="{{ url_for('static', filename='cully.png') }}" alt="Cully Logo" class="header-logo">
            </div>
        </div>

        <div class="dashboard-content">
            <!-- Unified Navigation -->
            <div class="dashboard-nav">
                <div class="nav-links">
                    <a href="{{ url_for('dashboard.admin') }}" class="nav-link {% if request.endpoint == 'dashboard.admin' %}active{% endif %}" id="nav-dashboard">
                        <i class="fa fa-home"></i> Dashboard
                    </a>
                    <a href="{{ url_for('dashboard.user_management') }}" class="nav-link {% if request.endpoint == 'dashboard.user_management' %}active{% endif %}" id="nav-users">
                        <i class="fa fa-users"></i> User Management
                    </a>
                    <a href="{{ url_for('dashboard.admin_reports') }}" class="nav-link {% if request.endpoint == 'dashboard.admin_reports' %}active{% endif %}" id="nav-reports">
                        <i class="fa fa-file-alt"></i> All Reports
                    </a>
                    <a href="{{ url_for('dashboard.system_settings') }}" class="nav-link {% if request.endpoint == 'dashboard.system_settings' %}active{% endif %}" id="nav-settings">
                        <i class="fa fa-cog"></i> System Settings
                    </a>
                    <a href="{{ url_for('main.sat_form') }}" class="nav-link {% if request.endpoint == 'main.sat_form' %}active{% endif %}" id="nav-create">
                        <i class="fa fa-plus"></i> Create Report
                    </a>
                    <a href="{{ url_for('auth.logout') }}" class="nav-link logout" id="nav-logout">
                        <i class="fa fa-sign-out-alt"></i> Logout
                    </a>
                </div>
            </div>

            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="flash-messages">
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }}">
                                <i class="fa fa-{% if category == 'success' %}check-circle{% elif category == 'error' %}exclamation-triangle{% else %}info-circle{% endif %}"></i>
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

            <!-- Main Content Area -->
            <div class="dashboard-main">
                {% block content %}{% endblock %}
            </div>
        </div>

        <!-- Developer Credit Footer -->
        <div class="developer-footer">
            <p style="margin: 0; font-size: 0.85rem; color: #64748b;">
                Developed by <strong style="color: var(--admin-primary);">Revanth Meda</strong> for Cully Automation
            </p>
        </div>
    </div>

    <!-- Unified JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            function updateDatabaseStatus() {
                fetch('/dashboard/db-status')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(HTTP );
                        }
                        return response.json();
                    })
                    .then(data => {
                        const statusElements = document.querySelectorAll('.status-badge');
                        statusElements.forEach(element => {
                            const textContent = element.textContent || '';
                            if (textContent.includes('Connected') || textContent.includes('Disconnected') || textContent.includes('Not Connected')) {
                                if (data.connected) {
                                    element.className = 'status-badge status-connected';
                                    element.innerHTML = '<i class="fa fa-circle" style="font-size: 8px; margin-right: 4px;"></i> Connected';
                                } else {
                                    element.className = 'status-badge status-disconnected';
                                    element.innerHTML = '<i class="fa fa-circle" style="font-size: 8px; margin-right: 4px;"></i> Disconnected';
                                }
                            }
                        });
                    })
                    .catch(() => {
                        const statusElements = document.querySelectorAll('.status-badge');
                        statusElements.forEach(element => {
                            const textContent = element.textContent || '';
                            if (textContent.includes('Connected') || textContent.includes('Disconnected') || textContent.includes('Not Connected')) {
                                element.className = 'status-badge status-disconnected';
                                element.innerHTML = '<i class="fa fa-circle" style="font-size: 8px; margin-right: 4px;"></i> Disconnected';
                            }
                        });
                    });
            }

            updateDatabaseStatus();
            setInterval(updateDatabaseStatus, 30000);

            window.showNotification = function(message, type) {
                const notification = document.createElement('div');
                notification.className = 
otification notification-;
                notification.style.cssText = 
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 15px 20px;
                    border-radius: 12px;
                    color: white;
                    font-weight: 600;
                    z-index: 1000;
                    max-width: 340px;
                    box-shadow: 0 10px 28px rgba(15, 23, 42, 0.2);
                ;

                if (type === 'success') {
                    notification.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                } else if (type === 'error') {
                    notification.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                } else if (type === 'warning') {
                    notification.style.background = 'linear-gradient(135deg, #f59e0b, #d97706)';
                } else {
                    notification.style.background = 'linear-gradient(135deg, #3b82f6, #1d4ed8)';
                }

                notification.textContent = message;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 5000);
            };
        });
    </script>

    {% include 'partials/chatbot_widget.html' %}
    <script src="{{ url_for('static', filename='js/chatbot-assistant.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/csrf_manager.js') }}"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>