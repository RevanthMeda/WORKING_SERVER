<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FDS Report Generator - Cully Automation</title>

  <div id="form-mode-data"
       data-edit-mode="{{ edit_mode|default(false)|tojson }}"
       data-is-new-report="{{ is_new_report|default(true)|tojson }}"
       data-submission-id="{{ submission_id|default('')|e }}"
       style="display: none;">
  </div>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/form.css') }}"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/welcome-cully.css') }}"/>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/sat_form_styles.css', v=5) }}"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet"/>

  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.5/dist/signature_pad.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/konva@9.3.0/konva.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="{{ url_for('static', filename='js/fds_form.js') }}" defer></script>
  <script src="{{ url_for('static', filename='js/system_architecture.js', v=5) }}" defer></script>

  <link rel="icon" href="{{ url_for('static', filename='img/favicon.ico') }}" type="image/x-icon">
</head>

<body>
  <div class="admin-container">
    <!-- Header -->
    <div class="admin-header">
      <div class="header-content">
        <div class="header-info">
          <h1><i class="fas fa-cogs"></i> FDS Report Generator</h1>
          <p>Create comprehensive Functional Design Specifications with digital workflows.</p>
        </div>
        <img src="{{ url_for('static', filename='cully.png') }}" alt="Cully Logo" class="header-logo">
      </div>
    </div>

    <!-- Navigation -->
    <div class="dashboard-nav">
      <div class="nav-left">
        <a href="{{ url_for('dashboard.engineer') }}" class="nav-item">
          <i class="fa fa-home"></i> Dashboard
        </a>
        <a href="{{ url_for('dashboard.admin') }}" class="nav-item">
          <i class="fa fa-cog"></i> Settings
        </a>
        <button type="button" class="nav-item" onclick="saveProgress()">
          <i class="fas fa-save"></i> Save Progress
        </button>
      </div>
      <div class="nav-right">
        <a href="{{ url_for('auth.logout') }}" class="nav-item logout-btn">
          <i class="fa fa-sign-out-alt"></i> Logout
        </a>
      </div>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="flash-messages">
      {% for category, message in messages %}
        <div class="flash-message">
          <i class="fa fa-check-circle"></i>
          {{ message }}
        </div>
      {% endfor %}
      </div>
    {% endif %}
    {% endwith %}

    <!-- Horizontal Progress Bar -->
    <div class="horizontal-progress-bar">
      <div class="progress-container">
        {% set steps = [
          (1, 'Basic Info', 'Document header details'),
          (2, 'Approvals', 'Prepared and reviewed by'),
          (3, 'Purpose & Scope', 'Project intent and boundaries'),
          (4, 'Equipment & Communication', 'Hardware and protocols'),
          (5, 'Signals & Testing', 'I/O detail and SAT results'),
          (6, 'Docs & Registers', 'Revisions, notices, modbus tables'),
          (7, 'Review & Submit', 'Final checks')
        ] %}
        {% for num, title, desc in steps %}
        <div id="prog-{{ num }}"
             class="progress-step {{ 'active' if num==1 else 'disabled' }}"
             data-step="{{ num }}">
          <div class="step-circle">{{ num }}</div>
          <div class="step-info">
            <div class="step-title">{{ title }}</div>
            <div class="step-description">{{ desc }}</div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Main Content -->
    <main class="full-width-content">
      <img src="{{ url_for('static', filename='Cully_Watermark.jpg') }}" class="watermark" alt="Watermark"/>

      <form id="fdsForm"
            method="POST"
            action="{{ url_for('reports.submit_fds') }}"
            novalidate
            onsubmit="return handleFormSubmit(event)">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}"/>
        <input type="hidden" name="submission_id" value="{{ submission_id }}"/>

        {% include 'fds/steps/step1_basic.html' %}
        {% include 'fds/steps/step2_approvals.html' %}
        {% include 'fds/steps/step3_versions.html' %}
        {% include 'fds/steps/step4_system.html' %}
        {% include 'fds/steps/step5_equipment.html' %}
        {% include 'fds/steps/step6_io.html' %}
        {% include 'fds/steps/step7_review.html' %}
      </form>

      {% include 'fds/partials/templates.html' %}
    </main>
  </div>
</body>
</html>
