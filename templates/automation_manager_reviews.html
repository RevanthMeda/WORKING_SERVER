{% extends 'base.html' %}

{% block title %}Reviews & Approvals - {{ super() }}{% endblock %}

{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard-light.css') }}">
  <style>
    .reviews-page {
      display: grid;
      gap: var(--space-xl);
    }

    .reviews-page__header {
      background: linear-gradient(135deg, rgba(123, 165, 199, 0.95), rgba(90, 127, 163, 0.95));
      border-radius: 24px;
      padding: var(--space-xl);
      color: var(--cully-white);
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }

    .reviews-page__header::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(255, 255, 255, 0.22), transparent 55%);
      pointer-events: none;
    }

    .reviews-page__header-content {
      position: relative;
      z-index: 1;
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-lg);
      justify-content: space-between;
      align-items: center;
    }

    .reviews-page__title {
      margin: 0;
      font-size: clamp(2.2rem, 3vw, 2.6rem);
      font-weight: 700;
    }

    .reviews-page__subtitle {
      margin: 0;
      max-width: 520px;
      color: rgba(255, 255, 255, 0.88);
      font-size: 1.05rem;
    }

    .reviews-page__badge {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
      padding: 0.45rem 0.9rem;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.18);
      color: var(--cully-white);
      font-weight: 600;
    }

    .reviews-nav {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-sm);
      align-items: center;
    }

    .reviews-nav__link {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
      padding: 0.55rem 1.1rem;
      border-radius: 12px;
      text-decoration: none;
      font-weight: 600;
      color: var(--cully-dark);
      background: rgba(255, 255, 255, 0.74);
      border: 1px solid rgba(255, 255, 255, 0.65);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .reviews-nav__link--active {
      background: var(--cully-white);
      box-shadow: var(--shadow-sm);
    }

    .reviews-nav__link:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .reviews-content {
      display: grid;
      gap: var(--space-lg);
    }

    .review-card {
      background: var(--cully-white);
      border-radius: 20px;
      padding: var(--space-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid rgba(90, 127, 163, 0.12);
      display: grid;
      gap: var(--space-md);
    }

    .review-card__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--space-md);
    }

    .review-card__title {
      margin: 0;
      font-size: 1.35rem;
      font-weight: 700;
      color: var(--cully-dark);
    }

    .status-chip {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      font-size: 0.9rem;
      font-weight: 600;
      background: rgba(245, 158, 11, 0.2);
      color: #b45309;
    }

    .review-card__meta {
      display: grid;
      gap: var(--space-sm);
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }

    .meta-block {
      background: rgba(90, 127, 163, 0.08);
      border-radius: 16px;
      padding: var(--space-sm) var(--space-md);
    }

    .meta-block__label {
      display: block;
      font-size: 0.8rem;
      color: var(--cully-gray);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.25rem;
    }

    .meta-block__value {
      margin: 0;
      color: var(--cully-dark);
      font-weight: 600;
    }

    .review-card__actions {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-sm);
      align-items: center;
    }

    .review-card__actions a {
      display: inline-flex;
      align-items: center;
      gap: var(--space-xs);
      padding: 0.6rem 1.1rem;
      border-radius: 12px;
      text-decoration: none;
      font-weight: 600;
      border: 1px solid rgba(90, 127, 163, 0.28);
      color: var(--cully-dark);
      background: rgba(255, 255, 255, 0.92);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .review-card__actions a:hover {
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .review-card__actions a.btn-primary {
      background: linear-gradient(135deg, var(--cully-blue), var(--cully-navy));
      color: var(--cully-white);
      border-color: transparent;
    }

    .reviews-empty {
      background: rgba(90, 127, 163, 0.06);
      border-radius: 20px;
      padding: var(--space-xl);
      text-align: center;
      color: var(--cully-gray);
      border: 1px dashed rgba(90, 127, 163, 0.35);
    }

    .reviews-empty i {
      font-size: 2.4rem;
      margin-bottom: var(--space-sm);
    }

    @media (max-width: 768px) {
      .reviews-page__header-content {
        flex-direction: column;
        align-items: flex-start;
      }

      .review-card__header {
        flex-direction: column;
        align-items: flex-start;
      }

      .reviews-nav {
        flex-direction: column;
        align-items: stretch;
      }

      .reviews-nav__link {
        width: 100%;
        justify-content: center;
      }

      .review-card__actions {
        flex-direction: column;
        align-items: stretch;
      }

      .review-card__actions a {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
{% endblock %}

{% block content %}
<section class="reviews-page">
  <header class="reviews-page__header">
    <div class="reviews-page__header-content">
      <div>
        <h1 class="reviews-page__title"><i class="fas fa-clipboard-check"></i> Reviews & Approvals</h1>
        <p class="reviews-page__subtitle">
          Review submissions awaiting your approval, coordinate feedback, and move projects forward.
        </p>
        <span class="reviews-page__badge">
          <i class="fas fa-clock"></i> {{ pending_reviews|length }} pending review{{ 's' if pending_reviews|length != 1 else '' }}
        </span>
      </div>
      <nav class="reviews-nav">
        <a class="reviews-nav__link" href="{{ url_for('dashboard.automation_manager') }}">
          <i class="fas fa-home"></i> Dashboard
        </a>
        <a class="reviews-nav__link reviews-nav__link--active" href="{{ url_for('dashboard.reviews') }}">
          <i class="fas fa-list-check"></i> Reviews & Approvals
        </a>
        <a class="reviews-nav__link" href="{{ url_for('reports.new') }}">
          <i class="fas fa-plus-circle"></i> Create Report
        </a>
        <a class="reviews-nav__link" href="{{ url_for('io_builder.index') }}">
          <i class="fas fa-sitemap"></i> I/O Builder
        </a>
        <a class="reviews-nav__link" href="{{ url_for('notifications.notification_center') }}">
          <i class="fas fa-bell"></i> Notifications
          {% if unread_count > 0 %}
            <span class="status-chip" style="background: rgba(255,255,255,0.2); color: var(--cully-white); border: none;">
              {{ unread_count }}
            </span>
          {% endif %}
        </a>
      </nav>
    </div>
  </header>

  <div class="reviews-content">
    {% if pending_reviews %}
      {% for review in pending_reviews %}
        <article class="review-card">
          <header class="review-card__header">
            <h2 class="review-card__title">{{ review.document_title or 'Untitled Submission' }}</h2>
            <span class="status-chip"><i class="fas fa-hourglass-half"></i> Awaiting Review</span>
          </header>

          <div class="review-card__meta">
            <div class="meta-block">
              <span class="meta-block__label">Client</span>
              <p class="meta-block__value">{{ review.client_name or 'Not specified' }}</p>
            </div>
            <div class="meta-block">
              <span class="meta-block__label">Project Reference</span>
              <p class="meta-block__value">{{ review.project_reference or 'Not specified' }}</p>
            </div>
            <div class="meta-block">
              <span class="meta-block__label">Prepared By</span>
              <p class="meta-block__value">{{ review.prepared_by or review.user_email }}</p>
            </div>
            <div class="meta-block">
              <span class="meta-block__label">Submitted</span>
              <p class="meta-block__value">
                {{ review.created_at.strftime('%Y-%m-%d %H:%M') if review.created_at else 'Unknown' }}
              </p>
            </div>
          </div>

          <footer class="review-card__actions">
            <a class="btn-primary" href="{{ url_for('approval.approve_submission', submission_id=review.id, stage=review.stage or 1) }}">
              <i class="fas fa-check-circle"></i> Review & Approve
            </a>
            <a href="{{ url_for('status.view_status', submission_id=review.id) }}">
              <i class="fas fa-eye"></i> View Details
            </a>
          </footer>
        </article>
      {% endfor %}
    {% else %}
      <div class="reviews-empty">
        <i class="fas fa-check-circle"></i>
        <h3>All caught up!</h3>
        <p>No pending reviews at the moment. Your queue will update automatically when reports arrive.</p>
      </div>
    {% endif %}
  </div>
</section>
{% endblock %}
